<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Man in the Pi Castle - Path Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.1/css/bulma.min.css">
    <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
  </head>
<body>


<nav class="nav">
  <div class="nav-left">
    <a class="nav-item">
      <img src="public/images/castle.png" alt="logo"> Man in the Pi Castle
    </a>
  </div>

  <div class="nav-center">
    <a class="nav-item">
      <span class="icon">
        <i class="fa fa-github"></i>
      </span>
    </a>
    <a class="nav-item">
      <span class="icon">
        <i class="fa fa-twitter"></i>
      </span>
    </a>
  </div>

  <!-- This "nav-toggle" hamburger menu is only visible on mobile -->
  <!-- You need JavaScript to toggle the "is-active" class on "nav-menu" -->
  <span class="nav-toggle">
    <span></span>
    <span></span>
    <span></span>
  </span>

  <!-- This "nav-menu" is hidden on mobile -->
  <!-- Add the modifier "is-active" to display it on mobile -->
  <div class="nav-right nav-menu">
    <a class="nav-item" href="/">
      Home
    </a>
    <a class="nav-item" href="/path">
      Path Service
    </a>

    <a class="nav-item" href="https://github.com/ManInThePiCastle">
      <img src="public/images/github.png" alt="logo">
    </a>
  </div>
</nav>

  <div style="margin: 0 auto; padding:40px 100px">

  <h1 class="title is-3">Path Service</h1>

  <div style="margin:0 auto">
    <canvas id="canvas" width="1000px" height="1000px" style=""></canvas>
  </div>

  <br /><br />
  <label class="label">Square Length (cm)</label>
  <input class="input" type="text" id="squareLength" />
  <br />
  <label class="label">Buffer Length</label>
  <br />
  <input class="input" type="text" id="buffer" />
  <br /><br />
  <label class="label">Calculate Path</label>
  <input class="input" type="text" id="fromMove" value="a1" /> to <input class="input" type="text" id="toMove" value="h8" /> <input id="move" type="submit" value="Go" />
</div>
  <script>

    var squareLength = 40;
    var buffer = 20;
    var outerBoardLength;
    var canvasWidth;
    var canvasHeight;

    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    $(function() {

      myStorage = localStorage;

      

      $('#squareLength').keyup(function () {
        squareLength = $(this).val();
        drawAll();
      });

      $('#buffer').keyup(function () {
        buffer = Number($(this).val());
        drawAll();
      });

      $('#move').click(function() {
        $.ajax({
          url: "https://maninthepicastle.iwa.ecovate.com/path",
          method: "GET",
          dataType: "json",
          data: {
            from: $('#fromMove').val(),
            to: $('#toMove').val()
          }
        }).done(function(data) {
          console.log(data);
          drawPath();
        })
      });


      $('#buffer').val(buffer);
      $('#squareLength').val(squareLength);
      drawAll();
      // init();

    });
var sun = new Image();
var moon = new Image();
var earth = new Image();

    function drawPath() {
      context.globalCompositeOperation = 'destination-over';
      // context.clearRect(0, 0, 300, 300); // clear canvas

      context.fillStyle = 'rgba(0, 0, 0, 0.4)';
      context.strokeStyle = 'rgba(0, 153, 255, 0.4)';
      context.save();
      context.translate(150, 150);

      // Earth
      var time = new Date();
      context.rotate( ((2 * Math.PI) / 60) * time.getSeconds() + ((2 * Math.PI) / 60000) * time.getMilliseconds() );
      context.translate(105, 0);
      context.fillRect(0, -12, 50, 24); // Shadow
      // context.drawImage(earth, -12, -12);

      // Moon
      context.save();
      context.rotate( ((2 * Math.PI) / 6) * time.getSeconds() + ((2 * Math.PI) / 6000) * time.getMilliseconds() );
      context.translate(0, 28.5);
      // context.drawImage(moon, -3.5, -3.5);
      context.restore();

      context.restore();
      
      context.beginPath();
      context.arc(150, 150, 105, 0, Math.PI * 2, false); // Earth orbit
      context.stroke();
     
      // context.drawImage(sun, 0, 0, 300, 300);

      window.requestAnimationFrame(draw);
    }

function init() {
  sun.src = 'https://mdn.mozillademos.org/files/1456/Canvas_sun.png';
  moon.src = 'https://mdn.mozillademos.org/files/1443/Canvas_moon.png';
  earth.src = 'https://mdn.mozillademos.org/files/1429/Canvas_earth.png';
  window.requestAnimationFrame(draw);
}

function draw() {
  var ctx = document.getElementById('canvas').getContext('2d');

  ctx.globalCompositeOperation = 'destination-over';
  ctx.clearRect(0, 0, 300, 300); // clear canvas

  ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
  ctx.strokeStyle = 'rgba(0, 153, 255, 0.4)';
  ctx.save();
  ctx.translate(150, 150);

  // Earth
  var time = new Date();
  ctx.rotate( ((2 * Math.PI) / 60) * time.getSeconds() + ((2 * Math.PI) / 60000) * time.getMilliseconds() );
  ctx.translate(105, 0);
  ctx.fillRect(0, -12, 50, 24); // Shadow
  ctx.drawImage(earth, -12, -12);

  // Moon
  ctx.save();
  ctx.rotate( ((2 * Math.PI) / 6) * time.getSeconds() + ((2 * Math.PI) / 6000) * time.getMilliseconds() );
  ctx.translate(0, 28.5);
  ctx.drawImage(moon, -3.5, -3.5);
  ctx.restore();

  ctx.restore();
  
  ctx.beginPath();
  ctx.arc(150, 150, 105, 0, Math.PI * 2, false); // Earth orbit
  ctx.stroke();
 

  window.requestAnimationFrame(draw);
}



    function drawAll() {

      context.clearRect(0, 0, canvasWidth, canvasHeight);

      outerBoardLength = squareLength*8+2*buffer;
      canvasWidth = squareLength*12+2*buffer
      canvasHeight = squareLength*8+2*buffer

      $('#canvas').attr('width', canvasWidth);
      $('#canvas').attr('height', canvasHeight);

      drawOuterBoard();
      drawBoard();
      drawSideBoard(0,buffer+squareLength*4);
      drawSideBoard(squareLength*2+outerBoardLength,buffer+squareLength*4);      
    }

    function drawBoard(){
      console.log(buffer)
      i = 0;
      colors = ["#F2C974", "#834626"];
      for (var x = 0; x < 8; x++) {
        for (var y = 0; y < 8; y++) {
          context.fillStyle = colors[(i+x)%2];
          context.fillRect(squareLength*2 + buffer + (squareLength*x), buffer + squareLength*y, squareLength, squareLength);
          i++;
        }
      }
    }

    function drawOuterBoard(){
      context.fillStyle = "#eee";
      context.fillRect(2*squareLength, 0, outerBoardLength, outerBoardLength);
    }

    function drawSideBoard(startX, startY){
      i = 0;
      colors = ["#82AE5F", "#A3D977"];
      for (var x = 0; x < 2; x++) {
        for (var y = 0; y < 4; y++) {
          context.fillStyle = colors[(i+x)%2];
          context.fillRect(startX+squareLength*x, startY+squareLength*y, squareLength, squareLength);
          i++;
        }
      }
    }



  </script>
</body>
</html>